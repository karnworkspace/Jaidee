# üìò LoanBand Display & Validation Fix

**Last Updated:** 2025-07-12

---

## üéØ Objective

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:

1. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Loanband ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö UX/UI ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏ß‡πâ
2. ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏à‡∏£‡∏¥‡∏á (asset value)

---

## ‚úÖ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á Loanband ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### Format ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ:

| ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ | ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 40 ‡∏õ‡∏µ | ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 30 ‡∏õ‡∏µ | ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 20 ‡∏õ‡∏µ | ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏õ‡∏µ |
|--------------------|----------------|----------------|----------------|----------------|
| ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (3,146)   | 4,055,854      | 3,538,085      | 3,197,885      | 1,646,436      |
| -10% (2,831)       | 4,132,585      | 3,605,021      | 3,258,385      | 1,677,584      |
| ...                | ...            | ...            | ...            | ...            |

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç:

- **‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô (horizontal)**: ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏π‡πâ‚Äù
- ‡∏ß‡∏ô loop `refbank` ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡πÉ‡∏ä‡πâ `Math.round(value * 100) / 100` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏™‡∏î‡∏á 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì)

---

## ‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå

### ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:
- ‡∏•‡∏∑‡∏°‡πÉ‡∏ä‡πâ `MIN(... , assetValue * LTV%)` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î loan amount

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:
> ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå 1,672,000 ‡∏ö‡∏≤‡∏ó  
> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå loan = 4,823,171 ‚ùå (‡∏Ñ‡∏ß‡∏£ max ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1,672,000 ‡∏ö‡∏≤‡∏ó)

---

## ‚úÖ Logic ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

```ts
function calculateLoanAmount({ income, debt, refbankRate, assetValue, LTV }) {
  const dsrBasedLoan = ((income * 0.7) - debt) / refbankRate * 1_000_000;
  const maxLoanFromAsset = assetValue * (LTV / 100);

  return Math.min(dsrBasedLoan, maxLoanFromAsset);
}
```

---

## üì¶ Pseudocode ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Render ‡∏ï‡∏≤‡∏£‡∏≤‡∏á

```ts
const debtScenarios = [0, -0.1, -0.2, -0.3, -0.4, -0.5, -0.6, -0.7];
const terms = [40, 30, 20, 10];
const output = [];

for (let i = 0; i < debtScenarios.length; i++) {
  const adjustedDebt = currentDebt * (1 + debtScenarios[i]);
  const row = {
    label: `${debtScenarios[i] * 100}%`,
    debt: adjustedDebt
  };

  for (let term of terms) {
    const refRate = refbank[bank][term];
    if (!refRate) {
      row[term] = "-";
    } else {
      row[term] = calculateLoanAmount({
        income, debt: adjustedDebt, refbankRate: refRate,
        assetValue, LTV
      });
    }
  }

  output.push(row);
}
```

---

## üõ†Ô∏è Dev Tips

- ‡πÄ‡∏ä‡πá‡∏Å `refbank[bank][term]` ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô render
- ‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡πÅ‡∏Ñ‡πà‡∏ï‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (`toFixed(2)`) ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
- ‡πÉ‡∏ä‡πâ CSS ‡∏´‡∏£‡∏∑‡∏≠ Tailwind ‡∏à‡∏±‡∏î UI ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö UX ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏ß‡πâ
