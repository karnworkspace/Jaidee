# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Jaidee

**‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:** ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Frontend, Backend ‡πÅ‡∏•‡∏∞ Database ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Jaidee
**‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** 13 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025

---

## üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      HTTP/REST API       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      SQL Queries      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> ‚îÇ                 ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> ‚îÇ                 ‚îÇ
‚îÇ   FRONTEND      ‚îÇ                          ‚îÇ   BACKEND       ‚îÇ                        ‚îÇ   DATABASE      ‚îÇ
‚îÇ   (React)       ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ   (Node.js)     ‚îÇ <‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ   (MySQL 8.0)   ‚îÇ
‚îÇ                 ‚îÇ      JSON Response       ‚îÇ                 ‚îÇ      Result Set        ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÇÔ∏è ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Ç‡∏≠‡∏á Database

### ‡πÅ‡∏ú‡∏ô‡∏†‡∏≤‡∏û Entity Relationship (ER Diagram)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          customers (‡πÅ‡∏°‡πà)              ‚îÇ
‚îÇ  PK: id                               ‚îÇ
‚îÇ  - date, name, age, phone             ‚îÇ
‚îÇ  - income, debt, propertyValue        ‚îÇ
‚îÇ  - targetBank, officer                ‚îÇ
‚îÇ  - created_at, updated_at             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚îÇ ONE-TO-MANY (1:N)
               ‚îÇ
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                ‚îÇ                  ‚îÇ                ‚îÇ
       ‚ñº                ‚ñº                  ‚ñº                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇloan_problems ‚îÇ  ‚îÇaction_plans  ‚îÇ  ‚îÇ   reports    ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ     (‡∏•‡∏π‡∏Å)    ‚îÇ  ‚îÇ     (‡∏•‡∏π‡∏Å)    ‚îÇ  ‚îÇ     (‡∏•‡∏π‡∏Å)    ‚îÇ  ‚îÇ              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îÇ              ‚îÇ
‚îÇPK: id        ‚îÇ  ‚îÇPK: id        ‚îÇ  ‚îÇPK: id        ‚îÇ  ‚îÇ              ‚îÇ
‚îÇFK: customer  ‚îÇ  ‚îÇFK: customer  ‚îÇ  ‚îÇFK: customer  ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ   _id        ‚îÇ  ‚îÇ   _id        ‚îÇ  ‚îÇ   _id        ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ- problem     ‚îÇ  ‚îÇ- plan        ‚îÇ  ‚îÇ- report_date ‚îÇ  ‚îÇ              ‚îÇ
‚îÇ- created_at  ‚îÇ  ‚îÇ- created_at  ‚îÇ  ‚îÇ- analyst     ‚îÇ  ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ  bank_rules  ‚îÇ
                            ‚îÇ  (‡∏≠‡∏¥‡∏™‡∏£‡∏∞)     ‚îÇ
                            ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                            ‚îÇPK: id        ‚îÇ
                            ‚îÇUK: bank_code ‚îÇ
                            ‚îÇ- bank_name   ‚îÇ
                            ‚îÇ- dsr_high    ‚îÇ
                            ‚îÇ- ltv_*       ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ    users     ‚îÇ
                            ‚îÇ  (‡∏≠‡∏¥‡∏™‡∏£‡∏∞)     ‚îÇ
                            ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                            ‚îÇPK: id        ‚îÇ
                            ‚îÇUK: username  ‚îÇ
                            ‚îÇ- password    ‚îÇ
                            ‚îÇ- role        ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå:
- **customers ‚Üí loan_problems**: 1 ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (1:N)
- **customers ‚Üí action_plans**: 1 ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (1:N)
- **customers ‚Üí reports**: 1 ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (1:N)
- **bank_rules**: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì)
- **users**: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Authentication)

---

## üìã ‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: Frontend ‚Üí Backend ‚Üí Database

### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (Create Customer)

#### 1.1 Frontend Form (`CustomerForm.js`)

**Component:** `src/components/CustomerForm.js`

```javascript
const [formData, setFormData] = useState({
  // üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
  date: '2025-10-13',              // ‚Üí customers.date
  officer: '‡∏ô‡∏≤‡∏¢‡∏û‡∏¥‡∏ä‡∏ç‡πå ‡∏™‡∏∏‡∏î‡∏ó‡∏±‡∏ô',       // ‚Üí customers.officer

  // üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
  name: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà',        // ‚Üí customers.name
  age: 35,                         // ‚Üí customers.age
  phone: '0812345678',             // ‚Üí customers.phone
  job: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô',       // ‚Üí customers.job
  position: '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ù‡πà‡∏≤‡∏¢',         // ‚Üí customers.position

  // üí≥ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
  income: 50000,                   // ‚Üí customers.income
  debt: 15000,                     // ‚Üí customers.debt
  targetDate: '2026-10',           // ‚Üí customers.targetDate (‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô 2026-10-01)
  targetBank: 'GHB',               // ‚Üí customers.targetBank

  // üè† ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô
  projectName: '‡πÄ‡∏™‡∏ô‡∏≤‡∏Ñ‡∏¥‡∏ó‡∏ó‡πå ‡πÄ‡∏ó‡∏û‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå',  // ‚Üí customers.projectName
  unit: '12/345',                  // ‚Üí customers.unit
  propertyPrice: 1900000,          // ‚Üí customers.propertyPrice
  discount: 50000,                 // ‚Üí customers.discount
  ltv: 90,                         // ‚Üí customers.ltv
  readyToTransfer: '2026-12',      // ‚Üí customers.readyToTransfer

  // üí∞ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°
  propertyType: '‡πÅ‡∏ô‡∏ß‡∏™‡∏π‡∏á',          // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì rentRatePerMillion
  rentRatePerMillion: 4100,        // ‚Üí customers.rentRatePerMillion
  installmentMonths: 36,           // ‚Üí customers.installmentMonths
  transferYear: 1,                 // ‚Üí customers.transferYear
});

// üî¥ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ (Dynamic Array)
const [selectedProblems, setSelectedProblems] = useState([
  '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£',
  '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå'
]);  // ‚Üí loan_problems table (multiple rows)

// üü¢ ‡πÅ‡∏ú‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (Dynamic Array)
const [selectedSolutions, setSelectedSolutions] = useState([
  '‡∏£‡∏≠‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Ç‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó Livnex ‡∏Å‡πà‡∏≠‡∏ô',
  '‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏π‡∏á(‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î)'
]);  // ‚Üí action_plans table (multiple rows)
```

#### 1.2 Backend Endpoint (`index.js`)

**API:** `POST /api/customers`

```javascript
app.post('/api/customers', authenticateToken, requireRole(['admin', 'data_entry']), async (req, res) => {
  // 1. ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Frontend
  const requestBody = req.body;

  // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì KPIs (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô DB ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô)
  const kpis = calculateKPIs(requestBody);
  // ‚Üí potentialScore, financialStatus, degreeOfOwnership

  // 3. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
  const customerData = {
    ...requestBody,
    loanProblem: requestBody.loanProblem || [],   // Array
    actionPlan: requestBody.actionPlan || [],     // Array
    ...kpis
  };

  // 4. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  const customerId = await insertCustomerWithDetails(
    customerData,              // ‚Üí customers table
    customerData.loanProblem,  // ‚Üí loan_problems table (multiple inserts)
    customerData.actionPlan    // ‚Üí action_plans table (multiple inserts)
  );

  // 5. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
  const newCustomer = await getCustomerWithDetails(customerId);

  // 6. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô DB)
  newCustomer.loanEstimation = calculateLoanEstimation(customerData);
  newCustomer.rentToOwnEstimation = calculateRentToOwn(customerData);

  res.status(201).json({
    message: 'Customer added successfully',
    customer: newCustomer
  });
});
```

#### 1.3 Database Layer (`database.js`)

**Function:** `insertCustomerWithDetails()`

```javascript
const insertCustomerWithDetails = async (customerData, loanProblems = [], actionPlans = []) => {
  const connection = await pool.getConnection();

  try {
    await connection.beginTransaction();

    // üìù 1. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏•‡∏á customers table
    const [customerResult] = await connection.execute(`
      INSERT INTO customers (
        date, name, age, phone, job, position,
        income, debt, targetDate, targetBank,
        propertyPrice, discount, ltv, ...
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ...)
    `, [
      sanitizeDate(customerData.date),           // ‡πÅ‡∏õ‡∏•‡∏á date format
      sanitizeValue(customerData.name),
      sanitizeValue(customerData.age),
      // ... ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ
    ]);

    const customerId = customerResult.insertId;   // ‡πÑ‡∏î‡πâ ID ‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà

    // üî¥ 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ (‡∏ß‡∏ô loop)
    if (loanProblems && loanProblems.length > 0) {
      const validProblems = loanProblems.filter(p => p !== null && p !== '');

      for (const problem of validProblems) {
        await connection.execute(
          'INSERT INTO loan_problems (customer_id, problem) VALUES (?, ?)',
          [customerId, problem]   // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏î‡πâ‡∏ß‡∏¢ customer_id (FK)
        );
      }
    }

    // üü¢ 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏ß‡∏ô loop)
    if (actionPlans && actionPlans.length > 0) {
      const validPlans = actionPlans.filter(p => p !== null && p !== '');

      for (const plan of validPlans) {
        await connection.execute(
          'INSERT INTO action_plans (customer_id, plan) VALUES (?, ?)',
          [customerId, plan]      // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏î‡πâ‡∏ß‡∏¢ customer_id (FK)
        );
      }
    }

    await connection.commit();
    return customerId;

  } catch (error) {
    await connection.rollback();
    throw error;
  }
};
```

#### 1.4 ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô Database

**‡∏ï‡∏≤‡∏£‡∏≤‡∏á customers:**
```sql
| id  | date       | name              | age | income  | debt   | targetBank | created_at          |
|-----|------------|-------------------|-----|---------|--------|------------|---------------------|
| 687 | 2025-10-13 | ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà  | 35  | 50000   | 15000  | GHB        | 2025-10-13 10:00:00 |
```

**‡∏ï‡∏≤‡∏£‡∏≤‡∏á loan_problems:**
```sql
| id   | customer_id | problem                                          | created_at          |
|------|-------------|--------------------------------------------------|---------------------|
| 2564 | 687         | ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà...    | 2025-10-13 10:00:00 |
| 2565 | 687         | ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå          | 2025-10-13 10:00:00 |
```

**‡∏ï‡∏≤‡∏£‡∏≤‡∏á action_plans:**
```sql
| id  | customer_id | plan                                      | created_at          |
|-----|-------------|-------------------------------------------|---------------------|
| 878 | 687         | ‡∏£‡∏≠‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Ç‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó Livnex ‡∏Å‡πà‡∏≠‡∏ô      | 2025-10-13 10:00:00 |
| 879 | 687         | ‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏π‡∏á(‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î)                       | 2025-10-13 10:00:00 |
```

---

### 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Read Customer)

#### 2.1 Backend Endpoint

**API:** `GET /api/customers/:id`

```javascript
app.get('/api/customers/:id', authenticateToken, async (req, res) => {
  const customerId = parseInt(req.params.id);

  // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  const customer = await getCustomerWithDetails(customerId);

  if (!customer) {
    return res.status(404).json({ message: 'Customer not found' });
  }

  res.json(customer);
});
```

#### 2.2 Database Layer

**Function:** `getCustomerWithDetails()`

```javascript
const getCustomerWithDetails = async (customerId) => {
  // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å customers table
  const customer = await executeQuery(
    'SELECT * FROM customers WHERE id = ?',
    [customerId]
  );

  if (customer.length === 0) return null;

  // 2. ‡∏î‡∏∂‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ (JOIN ‡πÇ‡∏î‡∏¢ customer_id)
  const loanProblems = await executeQuery(
    'SELECT * FROM loan_problems WHERE customer_id = ? ORDER BY created_at DESC',
    [customerId]
  );

  // 3. ‡∏î‡∏∂‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (JOIN ‡πÇ‡∏î‡∏¢ customer_id)
  const actionPlans = await executeQuery(
    'SELECT * FROM action_plans WHERE customer_id = ? ORDER BY created_at DESC',
    [customerId]
  );

  // 4. ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  return {
    ...customer[0],
    loanProblems: loanProblems || [],     // Array of problems
    actionPlans: actionPlans || []        // Array of plans
  };
};
```

#### 2.3 Response ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á Frontend

```json
{
  "id": 687,
  "date": "2025-10-13",
  "name": "‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà",
  "age": 35,
  "phone": "0812345678",
  "income": "50000.00",
  "debt": "15000.00",
  "targetBank": "GHB",
  "propertyPrice": "1900000.00",
  "discount": "50000.00",
  "ltv": "90.00",
  "created_at": "2025-10-13T03:00:00.000Z",
  "updated_at": "2025-10-13T03:00:00.000Z",

  "loanProblems": [
    {
      "id": 2564,
      "customer_id": 687,
      "problem": "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£",
      "created_at": "2025-10-13T03:00:00.000Z"
    },
    {
      "id": 2565,
      "customer_id": 687,
      "problem": "‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå",
      "created_at": "2025-10-13T03:00:00.000Z"
    }
  ],

  "actionPlans": [
    {
      "id": 878,
      "customer_id": 687,
      "plan": "‡∏£‡∏≠‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏Ç‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó Livnex ‡∏Å‡πà‡∏≠‡∏ô",
      "created_at": "2025-10-13T03:00:00.000Z"
    },
    {
      "id": 879,
      "customer_id": 687,
      "plan": "‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏π‡∏á(‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î)",
      "created_at": "2025-10-13T03:00:00.000Z"
    }
  ]
}
```

---

### 3. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Update Customer)

#### 3.1 Backend Endpoint

**API:** `PUT /api/customers/:id`

```javascript
app.put('/api/customers/:id', authenticateToken, requireRole(['admin', 'data_entry']), async (req, res) => {
  const customerId = parseInt(req.params.id);

  // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
  const existingCustomer = await getCustomerWithDetails(customerId);
  if (!existingCustomer) {
    return res.status(404).json({ message: 'Customer not found' });
  }

  // 2. ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
  const updatedCustomerData = { ...existingCustomer, ...req.body };

  // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì KPIs ‡πÉ‡∏´‡∏°‡πà
  const kpis = calculateKPIs(updatedCustomerData);

  // 4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  await updateCustomerWithDetails(
    customerId,
    { ...updatedCustomerData, ...kpis },
    req.body.loanProblem || [],    // ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà
    req.body.actionPlan || []       // ‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡∏°‡πà
  );

  res.json({ message: 'Customer updated successfully' });
});
```

#### 3.2 Database Layer

**Function:** `updateCustomerWithDetails()`

```javascript
const updateCustomerWithDetails = async (customerId, customerData, loanProblems = [], actionPlans = []) => {
  const connection = await pool.getConnection();

  try {
    await connection.beginTransaction();

    // üìù 1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    await connection.execute(`
      UPDATE customers SET
        date=?, name=?, age=?, phone=?, income=?, debt=?, targetBank=?,
        targetDate=?, propertyPrice=?, discount=?, ltv=?, ...
        updated_at=CURRENT_TIMESTAMP
      WHERE id=?
    `, [
      sanitizeDate(customerData.date),
      sanitizeValue(customerData.name),
      // ... ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ
      customerId
    ]);

    // üî¥ 2. ‡∏•‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    await connection.execute(
      'DELETE FROM loan_problems WHERE customer_id = ?',
      [customerId]
    );

    // üî¥ 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà
    if (loanProblems && loanProblems.length > 0) {
      const validProblems = loanProblems.filter(p => p !== null && p !== '');
      for (const problem of validProblems) {
        await connection.execute(
          'INSERT INTO loan_problems (customer_id, problem) VALUES (?, ?)',
          [customerId, problem]
        );
      }
    }

    // üü¢ 4. ‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    await connection.execute(
      'DELETE FROM action_plans WHERE customer_id = ?',
      [customerId]
    );

    // üü¢ 5. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡∏°‡πà
    if (actionPlans && actionPlans.length > 0) {
      const validPlans = actionPlans.filter(p => p !== null && p !== '');
      for (const plan of validPlans) {
        await connection.execute(
          'INSERT INTO action_plans (customer_id, plan) VALUES (?, ?)',
          [customerId, plan]
        );
      }
    }

    await connection.commit();

  } catch (error) {
    await connection.rollback();
    throw error;
  }
};
```

---

### 4. ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Delete Customer)

#### 4.1 Backend Endpoint

**API:** `DELETE /api/customers/:id`

```javascript
app.delete('/api/customers/:id', authenticateToken, requireRole(['admin']), async (req, res) => {
  const customerId = parseInt(req.params.id);

  // ‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (CASCADE ‡∏à‡∏∞‡∏•‡∏ö loan_problems ‡πÅ‡∏•‡∏∞ action_plans ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
  await deleteCustomer(customerId);

  res.json({ message: 'Customer deleted successfully' });
});
```

#### 4.2 Database Layer

**Function:** `deleteCustomer()`

```javascript
const deleteCustomer = async (customerId) => {
  // ‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ - Foreign Key Constraint ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  // ON DELETE CASCADE ‡πÉ‡∏ô loan_problems ‡πÅ‡∏•‡∏∞ action_plans
  await executeQuery('DELETE FROM customers WHERE id = ?', [customerId]);

  // ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
  // ‚úÖ ‡∏•‡∏ö‡πÉ‡∏ô customers (id=687)
  // ‚úÖ ‡∏•‡∏ö‡πÉ‡∏ô loan_problems (customer_id=687) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (CASCADE)
  // ‚úÖ ‡∏•‡∏ö‡πÉ‡∏ô action_plans (customer_id=687) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (CASCADE)
  // ‚úÖ ‡∏•‡∏ö‡πÉ‡∏ô reports (customer_id=687) ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (CASCADE)
};
```

---

## üîç ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ö‡∏ö Real-time (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô DB)

| ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏î‡∏¢ | ‡πÉ‡∏ä‡πâ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏à‡∏≤‡∏Å DB |
|--------|----------|----------------|
| **DSR** | `calculateKPIs()` | `debt` √∑ `income` √ó 100 |
| **propertyValue** | Frontend | `propertyPrice` - `discount` |
| **monthlyRent** | `calculateRentToOwn()` | `propertyValue` √ó `rentRatePerMillion` √∑ 1,000,000 |
| **loanEstimation** | `calculateLoanEstimation()` | `income`, `debt`, `ltv`, `loanTerm`, `targetBank` |
| **enhancedBankMatching** | `enhancedBankMatching()` | ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå + `bank_rules` table |
| **creditBureauAnalysis** | `analyzeCreditBureau()` | `creditScore`, `paymentHistory`, `accountStatuses` |

### ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

| ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Table | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï |
|--------|--------------|--------|-------------------|
| **potentialScore** | `customers.potentialScore` | DECIMAL(5,2) | ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà save |
| **financialStatus** | `customers.financialStatus` | VARCHAR(100) | ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà save |
| **degreeOfOwnership** | `customers.degreeOfOwnership` | DECIMAL(5,2) | ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà save |
| **actionPlanProgress** | `customers.actionPlanProgress` | DECIMAL(5,2) | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á |

---

## üîó ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

### Scenario: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ID 687

```
1Ô∏è‚É£ Frontend (CustomerForm.js)
   User ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: income = 60000, ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "‡∏Ç‡∏≤‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£"
   ‚Üì
   fetch('http://localhost:3001/api/customers/687', {
     method: 'PUT',
     body: JSON.stringify({
       income: 60000,
       loanProblem: ['‡∏õ‡∏±‡∏ç‡∏´‡∏≤1', '‡∏õ‡∏±‡∏ç‡∏´‡∏≤2', '‡∏Ç‡∏≤‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£']
     })
   })

2Ô∏è‚É£ Backend (index.js)
   ‚Üì
   PUT /api/customers/687
   ‚Üì
   calculateKPIs({ ...existingData, income: 60000 })
   ‚Üì
   updateCustomerWithDetails(687, updatedData, newProblems, ...)

3Ô∏è‚É£ Database (database.js)
   ‚Üì
   BEGIN TRANSACTION

   UPDATE customers
   SET income=60000, updated_at=NOW()
   WHERE id=687;

   DELETE FROM loan_problems WHERE customer_id=687;

   INSERT INTO loan_problems (customer_id, problem) VALUES
     (687, '‡∏õ‡∏±‡∏ç‡∏´‡∏≤1'),
     (687, '‡∏õ‡∏±‡∏ç‡∏´‡∏≤2'),
     (687, '‡∏Ç‡∏≤‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£');

   COMMIT;

4Ô∏è‚É£ Response
   ‚Üì
   {
     message: 'Customer updated successfully',
     customer: { id: 687, income: 60000, loanProblems: [...] }
   }

5Ô∏è‚É£ Frontend Update
   ‚Üì
   navigate('/customer/687') ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
```

---

## üìå Foreign Key Constraints ‡πÅ‡∏•‡∏∞ Cascading

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Foreign Keys

```sql
-- loan_problems
ALTER TABLE loan_problems
ADD CONSTRAINT fk_loan_problems_customer
FOREIGN KEY (customer_id)
REFERENCES customers(id)
ON DELETE CASCADE;

-- action_plans
ALTER TABLE action_plans
ADD CONSTRAINT fk_action_plans_customer
FOREIGN KEY (customer_id)
REFERENCES customers(id)
ON DELETE CASCADE;

-- reports
ALTER TABLE reports
ADD CONSTRAINT fk_reports_customer
FOREIGN KEY (customer_id)
REFERENCES customers(id)
ON DELETE CASCADE;
```

### ‡∏ú‡∏•‡∏Ç‡∏≠‡∏á CASCADE:

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö `customers.id = 687`:
- ‚úÖ **loan_problems** ‡∏ó‡∏µ‡πà‡∏°‡∏µ `customer_id = 687` ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‚úÖ **action_plans** ‡∏ó‡∏µ‡πà‡∏°‡∏µ `customer_id = 687` ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‚úÖ **reports** ‡∏ó‡∏µ‡πà‡∏°‡∏µ `customer_id = 687` ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

---

## üõ°Ô∏è Data Validation ‡πÅ‡∏•‡∏∞ Sanitization

### Frontend Validation (CustomerForm.js)

```javascript
// Required fields
<input type="text" name="name" required />
<input type="number" name="age" required min="18" max="100" />
<input type="tel" name="phone" pattern="[0-9]{10}" required />

// Date format
<input type="month" name="targetDate" />  // ‚Üí "2026-10"

// Select validation
<select name="targetBank" required>
  <option value="GHB">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (GHB)</option>
  ...
</select>
```

### Backend Validation (database.js)

```javascript
// sanitizeValue() - ‡πÅ‡∏õ‡∏•‡∏á undefined/null/empty ‚Üí null
const sanitizeValue = (value) => {
  if (value === undefined || value === null) return null;
  if (typeof value === 'string') {
    const trimmed = value.trim();
    if (trimmed === '') return null;
    return trimmed;
  }
  return value;
};

// sanitizeDate() - ‡πÅ‡∏õ‡∏•‡∏á partial date ‚Üí full date
const sanitizeDate = (dateValue) => {
  if (!dateValue) return null;

  // "2026-10" ‚Üí "2026-10-01"
  if (dateValue.match(/^\d{4}-\d{2}$/)) {
    return `${dateValue}-01`;
  }

  return dateValue;
};
```

---

## üìä ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á SQL Queries ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢

### 1. ‡∏î‡∏∂‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô

```sql
SELECT
  c.*,
  GROUP_CONCAT(DISTINCT lp.problem SEPARATOR '|') as problems,
  GROUP_CONCAT(DISTINCT ap.plan SEPARATOR '|') as plans
FROM customers c
LEFT JOIN loan_problems lp ON c.id = lp.customer_id
LEFT JOIN action_plans ap ON c.id = ap.customer_id
WHERE c.id = 687
GROUP BY c.id;
```

### 2. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞

```sql
SELECT DISTINCT c.*
FROM customers c
INNER JOIN loan_problems lp ON c.id = lp.customer_id
WHERE lp.problem LIKE '%Livnex%';
```

### 3. ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°

```sql
SELECT
  problem,
  COUNT(*) as count
FROM loan_problems
GROUP BY problem
ORDER BY count DESC
LIMIT 10;
```

### 4. ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

```sql
SELECT c.*
FROM customers c
LEFT JOIN action_plans ap ON c.id = ap.customer_id
WHERE ap.id IS NULL;
```

---

## üéØ Best Practices

### ‚úÖ DO:
- ‡πÉ‡∏ä‡πâ Transaction ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- ‡πÉ‡∏ä‡πâ `sanitizeValue()` ‡πÅ‡∏•‡∏∞ `sanitizeDate()` ‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Foreign Key ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡πÉ‡∏ä‡πâ Prepared Statements (?) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô SQL Injection
- ‡πÄ‡∏Å‡πá‡∏ö `created_at` ‡πÅ‡∏•‡∏∞ `updated_at` ‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á

### ‚ùå DON'T:
- ‡∏™‡πà‡∏á undefined ‡πÄ‡∏Ç‡πâ‡∏≤ SQL query (‡πÉ‡∏ä‡πâ null ‡πÅ‡∏ó‡∏ô)
- ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ backup
- Hard-code ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (‡πÉ‡∏ä‡πâ MySQL DATE format)
- Skip validation ‡πÉ‡∏ô Frontend
- ‡∏•‡∏∞‡πÄ‡∏ß‡πâ‡∏ô error handling ‡πÉ‡∏ô Transaction

---

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢:** Claude Code
**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡πà‡∏ô:** 1.0
**‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** 13 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025
