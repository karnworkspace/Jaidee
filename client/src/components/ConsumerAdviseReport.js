import React, { useState, useEffect, useRef, useCallback } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { API_ENDPOINTS } from '../config/api';
import styles from './ConsumerAdviseReport.module.css';
import jsPDF from 'jspdf';
import html2canvas from 'html2canvas';

const ConsumerAdviseReport = ({ customerData, onClose }) => {
  const { authenticatedFetch } = useAuth();
  const [reportData, setReportData] = useState(null);
  const [selectedInstallment, setSelectedInstallment] = useState(36);
  const [additionalNotes, setAdditionalNotes] = useState(['', '', '', '']);
  
  const [debtLimit, setDebtLimit] = useState('8000');
  const [loanTermAfter, setLoanTermAfter] = useState('40');
  const componentRef = useRef();

  const loadSavedReportData = useCallback(async () => {
    try {
      const response = await authenticatedFetch(API_ENDPOINTS.REPORT_BY_CUSTOMER(customerData.id));

      if (response.ok) {
        const savedData = await response.json();
        
        if (savedData && savedData.length > 0) {
          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏° ID ‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
          const sortedData = savedData.sort((a, b) => b.id - a.id);
          
          const latestReport = sortedData[0]; // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö
          
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï state ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
          setSelectedInstallment(latestReport.selected_installment || 36);
          setDebtLimit(latestReport.debt_limit?.toString() || '8000');
          setLoanTermAfter(latestReport.loan_term_after?.toString() || '40');
          
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
          if (latestReport.additional_notes) {
            try {
              let notes;
              if (typeof latestReport.additional_notes === 'string') {
                notes = JSON.parse(latestReport.additional_notes);
              } else {
                notes = latestReport.additional_notes;
              }
              // ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ 4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏™‡∏°‡∏≠
              const fullNotes = ['', '', '', ''];
              if (Array.isArray(notes)) {
                notes.forEach((note, index) => {
                  if (index < 4) {
                    fullNotes[index] = note || '';
                  }
                });
              }
              setAdditionalNotes(fullNotes);
            } catch (e) {
              // ‡∏ñ‡πâ‡∏≤ parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 4 ‡∏ï‡∏±‡∏ß
              setAdditionalNotes(['', '', '', '']);
            }
          } else {
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 4 ‡∏ï‡∏±‡∏ß
            setAdditionalNotes(['', '', '', '']);
          }
        } else {
          // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
          setAdditionalNotes(['', '', '', '']);
        }
      }
    } catch (error) {
      // Handle error silently or show user-friendly message if needed
    }
    }, [customerData.id, authenticatedFetch]);

  const initializeReport = useCallback(async () => {
    if (customerData) {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á reportData ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô
      const report = {
        ...customerData,
        reportDate: new Date().toLocaleDateString('th-TH'),
        analyst: customerData.officer || '‡∏ô‡∏≤‡∏¢‡∏û‡∏¥‡∏ä‡∏ç‡πå ‡∏™‡∏∏‡∏î‡∏ó‡∏±‡∏ô',
        
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
        income: parseFloat(customerData.income) || 0,
        debt: parseFloat(customerData.debt) || 0,
        loanTerm: parseInt(customerData.loanTerm) || 40,
        ltv: parseFloat(customerData.ltv) || 100,
        ltvNote: customerData.ltvNote || 'House 1 (‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà 1)',
        installmentRate: 10300, // ‡∏ö‡∏≤‡∏ó‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ 1 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó
        
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
        problems: customerData.loanProblem || [
          '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠'
        ],
        
        // ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
        actionPlan: customerData.actionPlan && customerData.actionPlan.length > 0 
          ? customerData.actionPlan 
          : ['‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'],
        expectedCompletion: customerData.targetDate 
          ? new Date(customerData.targetDate).toLocaleDateString('th-TH', { 
              year: 'numeric', 
              month: 'long' 
            })
          : '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô 2569',
        
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
        propertyValue: parseFloat(customerData.propertyPrice) || parseFloat(customerData.propertyValue) || 0,
        monthlyRent: customerData.detailedRentToOwnEstimation?.monthlyRent || 0,
        currentInstallment: 36, // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å 12 ‡πÄ‡∏õ‡πá‡∏ô 36
        remainingPrincipal: customerData.detailedRentToOwnEstimation?.remainingPrincipal || 0,
        
        // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å loanEstimation
        loanEstimationTable: customerData.loanEstimation || [
          { debt: 0, year40: 0, year30: 0, year20: 0, year10: 0 }
        ],
        
        // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å detailedRentToOwnEstimation
        amortizationTable: customerData.detailedRentToOwnEstimation?.amortizationTable || [
          { period: 6, savings: 0, remaining: 0 },
          { period: 12, savings: 0, remaining: 0 },
          { period: 18, savings: 0, remaining: 0 },
          { period: 24, savings: 0, remaining: 0 },
          { period: 30, savings: 0, remaining: 0 },
          { period: 36, savings: 0, remaining: 0 }
        ]
      };
      setReportData(report);
      
      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á reportData ‡πÅ‡∏•‡πâ‡∏ß
      try {
        await loadSavedReportData();
      } catch (error) {
        // Handle error silently
      }
    }
  }, [customerData, loadSavedReportData]);

  useEffect(() => {
    initializeReport();
  }, [initializeReport]);

  const handleExportHTML = async () => {
    try {
      if (!reportData) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô Export');
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á Export
      const exportButton = document.querySelector('.exportButton');
      if (exportButton) {
        exportButton.textContent = 'üìÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á Export...';
        exportButton.disabled = true;
      }

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML content ‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
      const htmlContent = `
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Consumer Advise - ${reportData.name || 'Report'}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sarabun', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: white;
      font-size: 14px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: white;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 30px;
      border-bottom: 2px solid #333;
      padding-bottom: 20px;
    }

    .logo h2 {
      color: #007bff;
      margin: 0;
      font-size: 24px;
    }

    .title {
      text-align: center;
      flex: 1;
      margin: 0 20px;
    }

    .title h1 {
      margin: 0 0 10px 0;
      color: #333;
      font-size: 28px;
    }

    .title p {
      margin: 0;
      color: #666;
      font-size: 14px;
    }

    .date p {
      margin: 0;
      color: #666;
      font-size: 14px;
    }

    /* Sections */
    .section {
      margin-bottom: 30px;
      page-break-inside: avoid;
    }

    .section h3 {
      color: #007bff;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
      margin-bottom: 20px;
      font-size: 20px;
    }

    /* Customer Info */
    .customer-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .info-row {
      display: flex;
      align-items: center;
    }

    .label {
      font-weight: bold;
      min-width: 120px;
      color: #333;
    }

    .value {
      color: #666;
      margin-left: 10px;
    }

    /* Problems */
    .problems {
      margin-left: 20px;
    }

    .problem-item {
      margin-bottom: 10px;
      padding: 10px;
      background: #f8f9fa;
      border-left: 4px solid #dc3545;
      border-radius: 4px;
    }

    /* Action Plan */
    .action-plan h4 {
      color: #007bff;
      margin: 20px 0 10px 0;
      font-size: 16px;
    }

    .action-plan p {
      margin-bottom: 8px;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      page-break-inside: avoid;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      font-size: 12px;
    }

    th {
      background: #007bff;
      color: white;
      font-weight: bold;
    }

    tr:nth-child(even) {
      background: #f8f9fa;
    }

    /* Disclaimer */
    .disclaimer-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #dc3545;
      page-break-inside: avoid;
    }

    .disclaimer-section p {
      margin: 15px 0;
      line-height: 1.6;
      text-align: justify;
    }

    .acknowledgement {
      margin: 25px 0;
      padding: 20px;
      background: #e7f3ff;
      border-radius: 5px;
      text-align: center;
    }

    .acknowledgement p {
      margin: 10px 0;
      font-weight: bold;
    }

    .signature-section {
      margin: 20px 0;
      text-align: center;
    }

    .advice-note {
      margin: 20px 0;
      padding: 15px;
      background: #fff3cd;
      border-radius: 5px;
      border-left: 4px solid #ffc107;
    }

    .analyst {
      text-align: right;
      margin-top: 30px;
      font-weight: bold;
      color: #333;
    }

    /* Contact Section */
    .contact-section {
      margin-top: 40px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      text-align: center;
    }

    .contact-info p {
      margin: 8px 0;
      font-weight: bold;
      color: #333;
    }

    .disclaimer {
      font-size: 12px;
      color: #666;
      font-style: italic;
      margin: 20px 0;
      text-align: center;
    }

    /* Print Styles */
    @media print {
      @page {
        size: A4;
        margin: 1.5cm;
      }

      body {
        font-size: 12px;
      }

      .section {
        page-break-inside: avoid;
        margin-bottom: 20px;
      }

      .section:nth-child(5) { /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ */
        page-break-before: page;
      }

      .section:nth-child(8) { /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° */
        page-break-before: page;
      }

      .section:nth-child(11) { /* ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå */
        page-break-before: page;
      }

      table {
        page-break-inside: avoid;
      }

      th, td {
        padding: 4px;
        font-size: 10px;
      }

      .section h3 {
        page-break-after: avoid;
        font-size: 16px;
      }

      .title h1 {
        font-size: 20px;
      }

      .logo h2 {
        font-size: 18px;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      .header {
        flex-direction: column;
        text-align: center;
      }

      .customer-info {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 10px;
      }

      th, td {
        padding: 4px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <h2>LIVNEX ‡πÉ‡∏à‡∏î‡∏µ</h2>
      </div>
      <div class="title">
        <h1>Consumer Advise Article</h1>
        <p>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏Å‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á LIVNEX ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</p>
      </div>
      <div class="date">
        <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${reportData.reportDate}</p>
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ -->
    <div class="section">
      <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
      <div class="customer-info">
        <div class="info-row">
          <span class="label">‡∏ä‡∏∑‡πà‡∏≠:</span>
          <span class="value">${reportData.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏≠‡∏≤‡∏¢‡∏∏:</span>
          <span class="value">${reportData.age || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} ‡∏õ‡∏µ</span>
        </div>
        <div class="info-row">
          <span class="label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span>
          <span class="value">${reportData.phone || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</span>
          <span class="value">${reportData.job || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</span>
          <span class="value">${reportData.position || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</span>
          <span class="value">${reportData.projectName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á:</span>
          <span class="value">${reportData.unit || reportData.roomNumber || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
          <span class="value">${(() => {
            const propertyPrice = parseFloat(reportData.propertyPrice) || parseFloat(reportData.propertyValue) || 0;
            const discount = parseFloat(reportData.discount) || 0;
            return (propertyPrice - discount).toLocaleString();
          })()} ‡∏ö‡∏≤‡∏ó</span>
        </div>
      </div>
    </div>

    <!-- ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ -->
    <div class="section">
      <h3>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</h3>
      <div class="problems">
        ${Array.isArray(reportData.problems) && reportData.problems.length > 0
          ? reportData.problems.map((problem, index) =>
              `<div class="problem-item">${index + 1}. ${problem}</div>`
            ).join('')
          : '<div class="problem-item">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</div>'
        }
      </div>
    </div>

    <!-- ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ -->
    <div class="section">
      <h3>‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ñ‡∏∂‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</h3>
      <div class="action-plan">
        <h4>‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥:</h4>
        ${(() => {
          const originalPlans = reportData.actionPlan && Array.isArray(reportData.actionPlan) && reportData.actionPlan.length > 0
            ? reportData.actionPlan
            : ['‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏'];

          const additionalPlans = additionalNotes
            .map((note, index) => ({ note: note.trim(), index }))
            .filter(item => item.note)
            .map(item => `‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏${item.index + 1}: ${item.note}`);

          const allPlans = [...originalPlans, ...additionalPlans];

          return allPlans.map((plan, index) => `<p>${index + 1}. ${plan}</p>`).join('');
        })()}
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ -->
    <div class="section">
      <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</h3>
      <div class="customer-info">
        <div class="info-row">
          <span class="label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
          <span class="value">${reportData.income?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
          <span class="value">${reportData.debt?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠:</span>
          <span class="value">${reportData.loanTerm || '40'} ‡∏õ‡∏µ</span>
        </div>
        <div class="info-row">
          <span class="label">LTV:</span>
          <span class="value">${reportData.ltv || '100'}% (${reportData.ltvNote || 'House 1 (‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà 1)'})</span>
        </div>
      </div>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ -->
    <div class="section">
      <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</h3>
      ${reportData.loanEstimationTable && reportData.loanEstimationTable.length > 0
        ? `<table>
            <thead>
              <tr>
                <th>‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ (‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</th>
                <th>40 ‡∏õ‡∏µ</th>
                <th>30 ‡∏õ‡∏µ</th>
                <th>20 ‡∏õ‡∏µ</th>
                <th>10 ‡∏õ‡∏µ</th>
              </tr>
            </thead>
            <tbody>
              ${reportData.loanEstimationTable.map((scenario) => {
                const label = scenario.label || '';
                const debt = scenario.debt || 0;
                const loanAmounts = scenario.loanAmounts || {};
                return `<tr>
                  <td>${label} (${debt.toLocaleString()})</td>
                  <td>${loanAmounts[40] ? loanAmounts[40].toLocaleString() : '0'}</td>
                  <td>${loanAmounts[30] ? loanAmounts[30].toLocaleString() : '0'}</td>
                  <td>${loanAmounts[20] ? loanAmounts[20].toLocaleString() : '0'}</td>
                  <td>${loanAmounts[10] ? loanAmounts[10].toLocaleString() : '0'}</td>
                </tr>`;
              }).join('')}
            </tbody>
          </table>`
        : '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</p>'
      }
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° -->
    <div class="section">
      <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</h3>
      <div class="customer-info">
        <div class="info-row">
          <span class="label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
          <span class="value">${reportData.propertyValue?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
          <span class="value">${reportData.monthlyRent?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà:</span>
          <span class="value">${selectedInstallment} ‡∏á‡∏ß‡∏î</span>
        </div>
        <div class="info-row">
          <span class="label">‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î:</span>
          <span class="value">${(() => {
            if (reportData.amortizationTable && reportData.amortizationTable.length > 0) {
              const selectedRow = reportData.amortizationTable.find(row => {
                const installment = row.installment || row.period || 0;
                return installment === selectedInstallment;
              });
              return selectedRow ? (selectedRow.remainingPrincipal || selectedRow.remaining || 0).toLocaleString() : '0';
            }
            return '0';
          })()} ‡∏ö‡∏≤‡∏ó</span>
        </div>
      </div>
    </div>

    <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ -->
    <div class="section">
      <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</h3>
      <p><strong>* ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${debtLimit} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</strong></p>
    </div>

    <!-- ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô -->
    <div class="section">
      <h3>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô</h3>
      <p><strong>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô: ${loanTermAfter} ‡∏õ‡∏µ</strong></p>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö -->
    <div class="section">
      <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h3>
      <table>
        <thead>
          <tr>
            <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
            <th>‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô</th>
            <th>‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</td>
            <td>${reportData.debt?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td>
            <td>${debtLimit} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td>
          </tr>
          <tr>
            <td>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</td>
            <td>${reportData.loanTerm || '40'} ‡∏õ‡∏µ</td>
            <td>${loanTermAfter} ‡∏õ‡∏µ</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° -->
    <div class="section">
      <h3>‡∏ú‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</h3>
      <p><strong>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</strong> ${reportData.propertyValue?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</p>
      <p><strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</strong> ${reportData.monthlyRent?.toLocaleString() || '0'}</p>

      ${reportData.amortizationTable && reportData.amortizationTable.length > 0
        ? `<table>
            <thead>
              <tr>
                <th>‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà</th>
                <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏° (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</th>
                <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</th>
              </tr>
            </thead>
            <tbody>
              ${reportData.amortizationTable
                .filter(row => {
                  const installment = row.installment || row.period || 0;
                  if (typeof installment === 'string' && installment.includes('‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î')) {
                    return true;
                  }
                  if (typeof installment === 'number') {
                    return [12, 24, 36].includes(installment);
                  }
                  return false;
                })
                .map((row) => {
                  const installment = row.installment || row.period || 0;
                  const savings = row.payment || row.savings || 0;
                  const remaining = row.remainingPrincipal || row.remaining || 0;

                  return `<tr>
                    <td>${installment}</td>
                    <td>${savings ? savings.toLocaleString() : '0'}</td>
                    <td>${remaining ? remaining.toLocaleString() : '0'}</td>
                  </tr>`;
                }).join('')}
            </tbody>
          </table>`
        : '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</p>'
      }

      <p class="disclaimer">
        ***‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£ ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ ‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏±‡∏ç‡∏ç‡∏≤ 4: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°‡∏ö‡πâ‡∏≤‡∏ô
      </p>

      <p class="analyst">
        <strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢:</strong> ${reportData.analyst}
      </p>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î -->
    <div class="section">
      <h3>‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î</h3>
      <div class="disclaimer-section">
        <p>
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏à‡∏î‡∏µ ‡∏à‡∏≥‡∏Å‡∏±‡∏î ("‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó") ‡∏Ç‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
        </p>
        <p>
          ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÉ‡∏î‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
        </p>

        <div class="acknowledgement">
          <p><strong>‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß</strong></p>
          <div class="signature-section">
            <p>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠: _________________ (‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°)</p>
          </div>
        </div>

        <div class="advice-note">
          <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ Livnex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏à‡∏î‡∏µ ‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</p>
        </div>

        <p class="analyst">
          <strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢:</strong> ${reportData.analyst}
        </p>
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
    <div class="contact-section">
      <div class="contact-info">
        <p><strong>LINE:</strong> @livnex</p>
        <p><strong>Website:</strong> www.livnex.co</p>
        <p><strong>Call:</strong> 1776</p>
      </div>
    </div>
  </div>
</body>
</html>
      `;

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå HTML ‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
      const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô_Consumer_Advise_${customerData?.name || customerData?.customer_name || 'Report'}_${new Date().toLocaleDateString('th-TH')}.html`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      alert('‚úÖ Export HTML ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\n‡πÑ‡∏ü‡∏•‡πå: ' + link.download + '\n\nüí° Tips: ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå HTML ‡πÉ‡∏ô browser ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Ctrl+P ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏õ‡πá‡∏ô PDF');

    } catch (error) {
      console.error('HTML Export Error:', error);
      alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô Export HTML\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ' + error.message);
    } finally {
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°
      const exportButton = document.querySelector('.exportButton');
      if (exportButton) {
        exportButton.textContent = 'üìÑ Export HTML';
        exportButton.disabled = false;
      }
    }
  };

  const handleQuickPDF = async () => {
    try {
      if (!reportData) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô Export');
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á Export
      const quickPdfButton = document.querySelector('.quickPdfButton');
      if (quickPdfButton) {
        quickPdfButton.textContent = 'üñ®Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° PDF...';
        quickPdfButton.disabled = true;
      }

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML content ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Export HTML
      const htmlContent = `
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Consumer Advise - ${reportData.name || 'Report'}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sarabun', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: white;
      font-size: 14px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: white;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 30px;
      border-bottom: 2px solid #333;
      padding-bottom: 20px;
    }

    .logo h2 {
      color: #007bff;
      margin: 0;
      font-size: 24px;
    }

    .title {
      text-align: center;
      flex: 1;
      margin: 0 20px;
    }

    .title h1 {
      margin: 0 0 10px 0;
      color: #333;
      font-size: 28px;
    }

    .title p {
      margin: 0;
      color: #666;
      font-size: 14px;
    }

    .date p {
      margin: 0;
      color: #666;
      font-size: 14px;
    }

    /* Sections */
    .section {
      margin-bottom: 30px;
      page-break-inside: avoid;
    }

    .section h3 {
      color: #007bff;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
      margin-bottom: 20px;
      font-size: 20px;
    }

    /* Customer Info */
    .customer-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .info-row {
      display: flex;
      align-items: center;
    }

    .label {
      font-weight: bold;
      min-width: 120px;
      color: #333;
    }

    .value {
      color: #666;
      margin-left: 10px;
    }

    /* Problems */
    .problems {
      margin-left: 20px;
    }

    .problem-item {
      margin-bottom: 10px;
      padding: 10px;
      background: #f8f9fa;
      border-left: 4px solid #dc3545;
      border-radius: 4px;
    }

    /* Action Plan */
    .action-plan h4 {
      color: #007bff;
      margin: 20px 0 10px 0;
      font-size: 16px;
    }

    .action-plan p {
      margin-bottom: 8px;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      page-break-inside: avoid;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      font-size: 12px;
    }

    th {
      background: #007bff;
      color: white;
      font-weight: bold;
    }

    tr:nth-child(even) {
      background: #f8f9fa;
    }

    /* Disclaimer */
    .disclaimer-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #dc3545;
      page-break-inside: avoid;
    }

    .disclaimer-section p {
      margin: 15px 0;
      line-height: 1.6;
      text-align: justify;
    }

    .acknowledgement {
      margin: 25px 0;
      padding: 20px;
      background: #e7f3ff;
      border-radius: 5px;
      text-align: center;
    }

    .acknowledgement p {
      margin: 10px 0;
      font-weight: bold;
    }

    .signature-section {
      margin: 20px 0;
      text-align: center;
    }

    .advice-note {
      margin: 20px 0;
      padding: 15px;
      background: #fff3cd;
      border-radius: 5px;
      border-left: 4px solid #ffc107;
    }

    .analyst {
      text-align: right;
      margin-top: 30px;
      font-weight: bold;
      color: #333;
    }

    /* Contact Section */
    .contact-section {
      margin-top: 40px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      text-align: center;
    }

    .contact-info p {
      margin: 8px 0;
      font-weight: bold;
      color: #333;
    }

    .disclaimer {
      font-size: 12px;
      color: #666;
      font-style: italic;
      margin: 20px 0;
      text-align: center;
    }

    /* Print Styles - Optimized for Quick PDF */
    @media print {
      @page {
        size: A4;
        margin: 1.5cm;
        -webkit-print-color-adjust: exact;
      }

      body {
        font-size: 11px;
        -webkit-print-color-adjust: exact;
      }

      .container {
        max-width: none;
        margin: 0;
        padding: 0;
      }

      .section {
        page-break-inside: avoid;
        margin-bottom: 20px;
      }

      /* Strategic page breaks for better layout */
      .section:nth-child(5) { /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ */
        page-break-before: page;
      }

      .section:nth-child(8) { /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° */
        page-break-before: page;
      }

      .section:nth-child(11) { /* ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå */
        page-break-before: page;
      }

      table {
        page-break-inside: avoid;
      }

      th, td {
        padding: 4px;
        font-size: 9px;
      }

      .section h3 {
        page-break-after: avoid;
        font-size: 14px;
      }

      .title h1 {
        font-size: 18px;
      }

      .logo h2 {
        font-size: 16px;
      }

      /* Ensure colors print */
      * {
        -webkit-print-color-adjust: exact !important;
        color-adjust: exact !important;
        print-color-adjust: exact !important;
      }
    }

    /* Auto-open print dialog */
    @media screen {
      body {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      }

      body.loaded {
        opacity: 1;
      }
    }
  </style>
  <script>
    // Auto-trigger print dialog when page loads
    window.addEventListener('load', function() {
      document.body.classList.add('loaded');
      setTimeout(function() {
        window.print();
      }, 500);
    });

    // Auto-close window after print dialog
    window.addEventListener('afterprint', function() {
      setTimeout(function() {
        window.close();
      }, 1000);
    });
  </script>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <h2>LIVNEX ‡πÉ‡∏à‡∏î‡∏µ</h2>
      </div>
      <div class="title">
        <h1>Consumer Advise Article</h1>
        <p>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏Å‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á LIVNEX ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</p>
      </div>
      <div class="date">
        <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${reportData.reportDate}</p>
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ -->
    <div class="section">
      <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
      <div class="customer-info">
        <div class="info-row">
          <span class="label">‡∏ä‡∏∑‡πà‡∏≠:</span>
          <span class="value">${reportData.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏≠‡∏≤‡∏¢‡∏∏:</span>
          <span class="value">${reportData.age || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} ‡∏õ‡∏µ</span>
        </div>
        <div class="info-row">
          <span class="label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span>
          <span class="value">${reportData.phone || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</span>
          <span class="value">${reportData.job || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</span>
          <span class="value">${reportData.position || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</span>
          <span class="value">${reportData.projectName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á:</span>
          <span class="value">${reportData.unit || reportData.roomNumber || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
          <span class="value">${(() => {
            const propertyPrice = parseFloat(reportData.propertyPrice) || parseFloat(reportData.propertyValue) || 0;
            const discount = parseFloat(reportData.discount) || 0;
            return (propertyPrice - discount).toLocaleString();
          })()} ‡∏ö‡∏≤‡∏ó</span>
        </div>
      </div>
    </div>

    <!-- ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ -->
    <div class="section">
      <h3>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</h3>
      <div class="problems">
        ${Array.isArray(reportData.problems) && reportData.problems.length > 0
          ? reportData.problems.map((problem, index) =>
              `<div class="problem-item">${index + 1}. ${problem}</div>`
            ).join('')
          : '<div class="problem-item">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</div>'
        }
      </div>
    </div>

    <!-- ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ -->
    <div class="section">
      <h3>‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ñ‡∏∂‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</h3>
      <div class="action-plan">
        <h4>‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥:</h4>
        ${(() => {
          const originalPlans = reportData.actionPlan && Array.isArray(reportData.actionPlan) && reportData.actionPlan.length > 0
            ? reportData.actionPlan
            : ['‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏'];

          const additionalPlans = additionalNotes
            .map((note, index) => ({ note: note.trim(), index }))
            .filter(item => item.note)
            .map(item => `‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏${item.index + 1}: ${item.note}`);

          const allPlans = [...originalPlans, ...additionalPlans];

          return allPlans.map((plan, index) => `<p>${index + 1}. ${plan}</p>`).join('');
        })()}
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ -->
    <div class="section">
      <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</h3>
      <div class="customer-info">
        <div class="info-row">
          <span class="label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
          <span class="value">${reportData.income?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
          <span class="value">${reportData.debt?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠:</span>
          <span class="value">${reportData.loanTerm || '40'} ‡∏õ‡∏µ</span>
        </div>
        <div class="info-row">
          <span class="label">LTV:</span>
          <span class="value">${reportData.ltv || '100'}% (${reportData.ltvNote || 'House 1 (‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà 1)'})</span>
        </div>
      </div>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ -->
    <div class="section">
      <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</h3>
      ${reportData.loanEstimationTable && reportData.loanEstimationTable.length > 0
        ? `<table>
            <thead>
              <tr>
                <th>‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ (‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</th>
                <th>40 ‡∏õ‡∏µ</th>
                <th>30 ‡∏õ‡∏µ</th>
                <th>20 ‡∏õ‡∏µ</th>
                <th>10 ‡∏õ‡∏µ</th>
              </tr>
            </thead>
            <tbody>
              ${reportData.loanEstimationTable.map((scenario) => {
                const label = scenario.label || '';
                const debt = scenario.debt || 0;
                const loanAmounts = scenario.loanAmounts || {};
                return `<tr>
                  <td>${label} (${debt.toLocaleString()})</td>
                  <td>${loanAmounts[40] ? loanAmounts[40].toLocaleString() : '0'}</td>
                  <td>${loanAmounts[30] ? loanAmounts[30].toLocaleString() : '0'}</td>
                  <td>${loanAmounts[20] ? loanAmounts[20].toLocaleString() : '0'}</td>
                  <td>${loanAmounts[10] ? loanAmounts[10].toLocaleString() : '0'}</td>
                </tr>`;
              }).join('')}
            </tbody>
          </table>`
        : '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</p>'
      }
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° -->
    <div class="section">
      <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</h3>
      <div class="customer-info">
        <div class="info-row">
          <span class="label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
          <span class="value">${reportData.propertyValue?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
          <span class="value">${reportData.monthlyRent?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
        </div>
        <div class="info-row">
          <span class="label">‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà:</span>
          <span class="value">${selectedInstallment} ‡∏á‡∏ß‡∏î</span>
        </div>
        <div class="info-row">
          <span class="label">‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î:</span>
          <span class="value">${(() => {
            if (reportData.amortizationTable && reportData.amortizationTable.length > 0) {
              const selectedRow = reportData.amortizationTable.find(row => {
                const installment = row.installment || row.period || 0;
                return installment === selectedInstallment;
              });
              return selectedRow ? (selectedRow.remainingPrincipal || selectedRow.remaining || 0).toLocaleString() : '0';
            }
            return '0';
          })()} ‡∏ö‡∏≤‡∏ó</span>
        </div>
      </div>
    </div>

    <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ -->
    <div class="section">
      <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</h3>
      <p><strong>* ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${debtLimit} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</strong></p>
    </div>

    <!-- ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô -->
    <div class="section">
      <h3>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô</h3>
      <p><strong>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô: ${loanTermAfter} ‡∏õ‡∏µ</strong></p>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö -->
    <div class="section">
      <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h3>
      <table>
        <thead>
          <tr>
            <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
            <th>‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô</th>
            <th>‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</td>
            <td>${reportData.debt?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td>
            <td>${debtLimit} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td>
          </tr>
          <tr>
            <td>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</td>
            <td>${reportData.loanTerm || '40'} ‡∏õ‡∏µ</td>
            <td>${loanTermAfter} ‡∏õ‡∏µ</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° -->
    <div class="section">
      <h3>‡∏ú‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</h3>
      <p><strong>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</strong> ${reportData.propertyValue?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</p>
      <p><strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</strong> ${reportData.monthlyRent?.toLocaleString() || '0'}</p>

      ${reportData.amortizationTable && reportData.amortizationTable.length > 0
        ? `<table>
            <thead>
              <tr>
                <th>‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà</th>
                <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏° (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</th>
                <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</th>
              </tr>
            </thead>
            <tbody>
              ${reportData.amortizationTable
                .filter(row => {
                  const installment = row.installment || row.period || 0;
                  if (typeof installment === 'string' && installment.includes('‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î')) {
                    return true;
                  }
                  if (typeof installment === 'number') {
                    return [12, 24, 36].includes(installment);
                  }
                  return false;
                })
                .map((row) => {
                  const installment = row.installment || row.period || 0;
                  const savings = row.payment || row.savings || 0;
                  const remaining = row.remainingPrincipal || row.remaining || 0;

                  return `<tr>
                    <td>${installment}</td>
                    <td>${savings ? savings.toLocaleString() : '0'}</td>
                    <td>${remaining ? remaining.toLocaleString() : '0'}</td>
                  </tr>`;
                }).join('')}
            </tbody>
          </table>`
        : '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</p>'
      }

      <p class="disclaimer">
        ***‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£ ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ ‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏±‡∏ç‡∏ç‡∏≤ 4: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°‡∏ö‡πâ‡∏≤‡∏ô
      </p>

      <p class="analyst">
        <strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢:</strong> ${reportData.analyst}
      </p>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î -->
    <div class="section">
      <h3>‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î</h3>
      <div class="disclaimer-section">
        <p>
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏à‡∏î‡∏µ ‡∏à‡∏≥‡∏Å‡∏±‡∏î ("‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó") ‡∏Ç‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
        </p>
        <p>
          ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÉ‡∏î‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
        </p>

        <div class="acknowledgement">
          <p><strong>‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß</strong></p>
          <div class="signature-section">
            <p>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠: _________________ (‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°)</p>
          </div>
        </div>

        <div class="advice-note">
          <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ Livnex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏à‡∏î‡∏µ ‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</p>
        </div>

        <p class="analyst">
          <strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢:</strong> ${reportData.analyst}
        </p>
      </div>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
    <div class="contact-section">
      <div class="contact-info">
        <p><strong>LINE:</strong> @livnex</p>
        <p><strong>Website:</strong> www.livnex.co</p>
        <p><strong>Call:</strong> 1776</p>
      </div>
    </div>
  </div>
</body>
</html>
      `;

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á popup window ‡πÉ‡∏´‡∏°‡πà
      const printWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');

      if (!printWindow) {
        alert('‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å popup window\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï popup ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ');
        return;
      }

      // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô HTML ‡∏•‡∏á‡πÉ‡∏ô popup window
      printWindow.document.write(htmlContent);
      printWindow.document.close();

      // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏¥‡∏î print dialog
      printWindow.focus();

      alert('‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î Print Window ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n\nüí° Tips: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Save as PDF" ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô');

    } catch (error) {
      console.error('Quick PDF Error:', error);
      alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô Quick PDF\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ' + error.message);
    } finally {
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°
      const quickPdfButton = document.querySelector('.quickPdfButton');
      if (quickPdfButton) {
        quickPdfButton.textContent = 'üñ®Ô∏è Quick PDF';
        quickPdfButton.disabled = false;
      }
    }
  };

  const handlePrint = async () => {
    try {
      if (!reportData) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå');
        return;
      }
      if (!componentRef.current) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå');
        return;
      }

      // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° DOM ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå
      const reportContainer = document.querySelector('.reportContainer');
      const originalBodyOverflow = document.body.style.overflow;
      const originalBodyBackground = document.body.style.background;

      // ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå
      document.body.style.overflow = 'visible';
      document.body.style.background = 'white';
      reportContainer.classList.add('print-ready');

      // ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå
      const printStyle = document.createElement('style');
      printStyle.id = 'print-temp-style';
      printStyle.textContent = `
        @media print {
          body * {
            visibility: hidden;
          }

          .reportContainer,
          .reportContainer * {
            visibility: visible;
          }

          .reportContainer {
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
            width: 100% !important;
            height: auto !important;
            background: white !important;
            padding: 0 !important;
            margin: 0 !important;
            box-shadow: none !important;
          }

          .reportContent {
            max-height: none !important;
            overflow: visible !important;
            margin: 0 !important;
            padding: 15px !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            max-width: none !important;
          }

          /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° */
          .printControls,
          .noteInputSection,
          .debtLimitInput,
          .loanTermInput {
            display: none !important;
          }

          /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
          .section {
            page-break-inside: avoid !important;
            margin-bottom: 15px !important;
          }

          /* ‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */
          .section:nth-of-type(5) { /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ */
            page-break-before: page !important;
          }

          .section:nth-of-type(8) { /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° */
            page-break-before: page !important;
          }

          .section:nth-of-type(11) { /* ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå */
            page-break-before: page !important;
          }

          /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
          .amortizationTable,
          .loanEstimationTable,
          .comparisonTable {
            page-break-inside: avoid !important;
            font-size: 10px !important;
          }

          .amortizationTable th,
          .loanEstimationTable th,
          .comparisonTable th,
          .amortizationTable td,
          .loanEstimationTable td,
          .comparisonTable td {
            padding: 4px !important;
            font-size: 9px !important;
          }

          /* ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ */
          .section h3 {
            page-break-after: avoid !important;
            font-size: 14px !important;
            margin-bottom: 8px !important;
          }

          .header {
            margin-bottom: 20px !important;
            padding-bottom: 10px !important;
          }

          .title h1 {
            font-size: 18px !important;
          }

          .logo h2 {
            font-size: 16px !important;
          }

          /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
          .customerInfo {
            font-size: 11px !important;
          }

          .infoRow {
            margin-bottom: 3px !important;
          }

          .label {
            min-width: 80px !important;
            font-size: 10px !important;
          }

          .value {
            font-size: 10px !important;
          }

          /* ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ */
          .problemItem {
            font-size: 10px !important;
            padding: 5px !important;
            margin-bottom: 5px !important;
          }

          /* ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô */
          .actionPlan p {
            font-size: 10px !important;
            margin-bottom: 3px !important;
          }

          .actionPlan h4 {
            font-size: 12px !important;
            margin: 8px 0 5px 0 !important;
          }

          /* Disclaimer */
          .disclaimerSection {
            font-size: 9px !important;
          }

          .disclaimerSection p {
            line-height: 1.3 !important;
            margin: 8px 0 !important;
          }

          .acknowledgement {
            font-size: 10px !important;
            padding: 10px !important;
          }

          .adviceNote {
            font-size: 9px !important;
            padding: 8px !important;
          }

          /* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ */
          .contactSection {
            font-size: 10px !important;
            padding: 10px !important;
          }
        }
      `;
      document.head.appendChild(printStyle);

      // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
      // eslint-disable-next-line no-restricted-globals
      const printConfirm = confirm(
        'üñ®Ô∏è ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå PDF Report\n\n' +
        '‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:\n' +
        '1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Save as PDF" ‡∏´‡∏£‡∏∑‡∏≠ "Microsoft Print to PDF"\n' +
        '2. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÄ‡∏õ‡πá‡∏ô A4\n' +
        '3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "More settings" ‚Üí ‡∏ï‡∏¥‡πä‡∏Å "Background graphics"\n' +
        '4. ‡∏Å‡∏î "Save" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF\n\n' +
        '‡∏Ñ‡∏•‡∏¥‡∏Å "OK" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå'
      );

      if (printConfirm) {
        // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
        window.print();
      }

      // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î
      setTimeout(() => {
        // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
        document.body.style.overflow = originalBodyOverflow;
        document.body.style.background = originalBodyBackground;
        reportContainer.classList.remove('print-ready');

        // ‡∏•‡∏ö CSS ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
        const tempStyle = document.getElementById('print-temp-style');
        if (tempStyle) {
          tempStyle.remove();
        }
      }, 1000);

    } catch (error) {
      console.error('Print Error:', error);
      alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ' + error.message);
    }
  };

  const handleSave = async () => {
    try {
      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
      const saveButton = document.querySelector('.saveButton');
      if (saveButton) {
        saveButton.textContent = 'üíæ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
        saveButton.disabled = true;
      }
      
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
      await saveReportData();
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:\n- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° 4 ‡∏Ç‡πâ‡∏≠\n- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ\n- ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô');
      
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°
      if (saveButton) {
        saveButton.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
        saveButton.disabled = false;
      }
    } catch (error) {
      alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
      
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°
      const saveButton = document.querySelector('.saveButton');
      if (saveButton) {
        saveButton.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
        saveButton.disabled = false;
      }
    }
  };

  const saveReportData = async () => {
    try {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
      const reportDataToSave = {
        customerId: customerData.id,
        customerName: customerData.name,
        reportDate: new Date().toISOString(),
        selectedInstallment: selectedInstallment,
        additionalNotes: additionalNotes,
        debtLimit: parseInt(debtLimit),
        loanTermAfter: parseInt(loanTermAfter),
        analyst: customerData.officer || '‡∏ô‡∏≤‡∏¢‡∏û‡∏¥‡∏ä‡∏ç‡πå ‡∏™‡∏∏‡∏î‡∏ó‡∏±‡∏ô',
      };

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      const response = await authenticatedFetch(API_ENDPOINTS.REPORTS, {
        method: 'POST',
        body: JSON.stringify(reportDataToSave)
      });

      if (response.ok) {
        const result = await response.json();
        return result;
      } else {
        const errorText = await response.text();
        throw new Error(`HTTP ${response.status}: ${errorText}`);
      }
    } catch (error) {
      throw error;
    }
  };

  const handleNoteChange = (index, value) => {
    const newNotes = [...additionalNotes];
    newNotes[index] = value;
    setAdditionalNotes(newNotes);
  };

  const handleDebtLimitChange = (e) => {
    const value = e.target.value.replace(/[^0-9]/g, '');
    setDebtLimit(value);
  };

  const handleLoanTermChange = (e) => {
    const value = e.target.value.replace(/[^0-9]/g, '').slice(0, 2);
    setLoanTermAfter(value);
  };

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ reportData ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (!reportData) {
    return (
      <div className={styles.reportContainer}>
        <div className={styles.loading}>
          <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô...</p>
        </div>
      </div>
    );
  }

  return (
    <div className={styles.reportContainer}>
      {/* Print Controls */}
      <div className={styles.printControls}>
        <div className={styles.buttonControls}>
          <button onClick={handleSave} className={styles.saveButton}>
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
          </button>
{/* Export HTML ‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ Quick PDF ‡πÅ‡∏•‡πâ‡∏ß
          <button onClick={handleExportHTML} className={styles.exportButton}>
            üìÑ Export HTML
          </button>
          */}
          <button onClick={handleQuickPDF} className={styles.quickPdfButton}>
            üñ®Ô∏è Quick PDF (Hot Reload Test)
          </button>
          <button onClick={onClose} className={styles.closeButton}>
            ‚ùå ‡∏õ‡∏¥‡∏î
          </button>
        </div>
      </div>



      <div className={styles.reportContent}>
        <div ref={componentRef}>
          {/* Header */}
          <div className={styles.header}>
            <div className={styles.logo}>
              <h2>LIVNEX ‡πÉ‡∏à‡∏î‡∏µ</h2>
            </div>
            <div className={styles.title}>
              <h1>Consumer Advise Article</h1>
              <p>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏Å‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á LIVNEX ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</p>
            </div>
            <div className={styles.date}>
              <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {reportData.reportDate}</p>
            </div>
          </div>

          {/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */}
          <div className={styles.section}>
            <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
            <div className={styles.customerInfo}>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏ä‡∏∑‡πà‡∏≠:</span>
                <span className={styles.value}>{reportData.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏≠‡∏≤‡∏¢‡∏∏:</span>
                <span className={styles.value}>{reportData.age || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} ‡∏õ‡∏µ</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span>
                <span className={styles.value}>{reportData.phone || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</span>
                <span className={styles.value}>{reportData.job || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</span>
                <span className={styles.value}>{reportData.position || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</span>
                <span className={styles.value}>{reportData.projectName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á:</span>
                <span className={styles.value}>{reportData.unit || reportData.roomNumber || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
                <span className={styles.value}>
                  {(() => {
                    const propertyPrice = parseFloat(reportData.propertyPrice) || parseFloat(reportData.propertyValue) || 0;
                    const discount = parseFloat(reportData.discount) || 0;
                    return (propertyPrice - discount).toLocaleString();
                  })()} ‡∏ö‡∏≤‡∏ó
                </span>
              </div>
            </div>
          </div>

          {/* ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ */}
          <div className={styles.section}>
            <h3>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</h3>
            <div className={styles.problems}>
              {Array.isArray(reportData.problems) && reportData.problems.length > 0 ? (
                reportData.problems.map((problem, index) => (
                  <div key={index} className={styles.problemItem}>
                    {index + 1}. {problem}
                  </div>
                ))
              ) : (
                <div className={styles.problemItem}>
                  ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠
                </div>
              )}
            </div>
          </div>

          {/* ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ */}
          <div className={styles.section}>
            <h3>‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ñ‡∏∂‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</h3>
            <div className={styles.actionPlan}>
              <h4>‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥:</h4>
              {(() => {
                // ‡∏£‡∏ß‡∏°‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏±‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                const originalPlans = reportData.actionPlan && Array.isArray(reportData.actionPlan) && reportData.actionPlan.length > 0 
                  ? reportData.actionPlan 
                  : ['‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏'];
                

                const additionalPlans = additionalNotes
                  .map((note, index) => ({ note: note.trim(), index }))
                  .filter(item => item.note) // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                  .map(item => `‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏${item.index + 1}: ${item.note}`);
                
                const allPlans = [...originalPlans, ...additionalPlans];
                
                return (
                  <div>
                    {allPlans.map((plan, index) => (
                      <p key={index}>{index + 1}. {plan}</p>
                    ))}
                  </div>
                );
              })()}

              {/* Input Controls - ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå */}
              <div className={styles.noteInputSection}>
                <h4>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</h4>
                {additionalNotes.map((note, index) => (
                  <div key={index} className={styles.noteInput}>
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ {index + 1}:</label>
                    <input
                      type="text"
                      value={note}
                      onChange={(e) => handleNoteChange(index, e.target.value)}
                      className={styles.noteTextBox}
                      placeholder={`‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ${index + 1}`}
                    />
                  </div>
                ))}
              </div>

              {/* Debt Limit Input - ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå */}
              <div className={styles.debtLimitInput}>
                <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ:</label>
                <div className={styles.debtLimitWrapper}>
                  <span className={styles.debtLimitText}>* ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô</span>
                  <input
                    type="text"
                    value={debtLimit}
                    onChange={handleDebtLimitChange}
                    className={styles.debtLimitNumber}
                    placeholder="8000"
                  />
                  <span className={styles.debtLimitUnit}>‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                </div>
              </div>

              {/* Loan Term Input - ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå */}
              <div className={styles.loanTermInput}>
                <label>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô:</label>
                <div className={styles.loanTermWrapper}>
                  <span className={styles.loanTermText}>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô:</span>
                  <input
                    type="text"
                    value={loanTermAfter}
                    onChange={handleLoanTermChange}
                    className={styles.loanTermNumber}
                    placeholder="40"
                    maxLength="2"
                  />
                  <span className={styles.loanTermUnit}>‡∏õ‡∏µ</span>
                </div>
              </div>
            </div>
          </div>

          {/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ */}
          <div className={styles.section}>
            <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</h3>
            <div className={styles.incomeDebtInfo}>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                <span className={styles.value}>{reportData.income?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                <span className={styles.value}>{reportData.debt?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠:</span>
                <span className={styles.value}>{reportData.loanTerm || '40'} ‡∏õ‡∏µ</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>LTV:</span>
                <span className={styles.value}>{reportData.ltv || '100'}% ({reportData.ltvNote || 'House 1 (‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà 1)'})</span>
              </div>
            </div>
          </div>

          {/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ */}
          <div className={styles.section}>
            <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</h3>
            {reportData.loanEstimationTable && reportData.loanEstimationTable.length > 0 ? (
              <table className={styles.loanEstimationTable}>
                <thead>
                  <tr>
                    <th>‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ (‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</th>
                    <th>40 ‡∏õ‡∏µ</th>
                    <th>30 ‡∏õ‡∏µ</th>
                    <th>20 ‡∏õ‡∏µ</th>
                    <th>10 ‡∏õ‡∏µ</th>
                  </tr>
                </thead>
                <tbody>
                  {reportData.loanEstimationTable.map((scenario, index) => {
                    const label = scenario.label || '';
                    const debt = scenario.debt || 0;
                    const loanAmounts = scenario.loanAmounts || {};
                    return (
                      <tr key={index}>
                        <td>{label} ({debt.toLocaleString()})</td>
                        <td>{loanAmounts[40] ? loanAmounts[40].toLocaleString() : '0'}</td>
                        <td>{loanAmounts[30] ? loanAmounts[30].toLocaleString() : '0'}</td>
                        <td>{loanAmounts[20] ? loanAmounts[20].toLocaleString() : '0'}</td>
                        <td>{loanAmounts[10] ? loanAmounts[10].toLocaleString() : '0'}</td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            ) : (
              <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</p>
            )}
          </div>

          {/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° */}
          <div className={styles.section}>
            <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</h3>
            <div className={styles.rentToOwnInfo}>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
                <span className={styles.value}>{reportData.propertyValue?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</span>
                <span className={styles.value}>{reportData.monthlyRent?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà:</span>
                <span className={styles.value}>{selectedInstallment} ‡∏á‡∏ß‡∏î</span>
              </div>
              <div className={styles.infoRow}>
                <span className={styles.label}>‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î:</span>
                <span className={styles.value}>
                  {(() => {
                    if (reportData.amortizationTable && reportData.amortizationTable.length > 0) {
                      const selectedRow = reportData.amortizationTable.find(row => {
                        const installment = row.installment || row.period || 0;
                        return installment === selectedInstallment;
                      });
                      return selectedRow ? (selectedRow.remainingPrincipal || selectedRow.remaining || 0).toLocaleString() : '0';
                    }
                    return '0';
                  })()} ‡∏ö‡∏≤‡∏ó
                </span>
              </div>
            </div>
          </div>

          {/* ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ */}
          <div className={styles.section}>
            <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</h3>
            <div className={styles.debtLimitInfo}>
              <p><strong>* ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î) ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô {debtLimit} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</strong></p>
            </div>
          </div>

          {/* ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô */}
          <div className={styles.section}>
            <h3>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô</h3>
            <div className={styles.loanTermInfo}>
              <p><strong>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô: {loanTermAfter} ‡∏õ‡∏µ</strong></p>
            </div>
          </div>

          {/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö */}
          <div className={styles.section}>
            <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h3>
            <table className={styles.comparisonTable}>
              <thead>
                <tr>
                  <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                  <th>‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô</th>
                  <th>‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ú‡∏ô</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</td>
                  <td>{reportData.debt?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td>
                  <td>{debtLimit} ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</td>
                </tr>
                <tr>
                  <td>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</td>
                  <td>{reportData.loanTerm || '40'} ‡∏õ‡∏µ</td>
                  <td>{loanTermAfter} ‡∏õ‡∏µ</td>
                </tr>
              </tbody>
            </table>
          </div>

          {/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏° */}
          <div className={styles.section}>
            <h3>‡∏ú‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</h3>
            <div className={styles.amortizationInfo}>
              <p><strong>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</strong> {reportData.propertyValue?.toLocaleString() || '0'} ‡∏ö‡∏≤‡∏ó</p>
              <p><strong>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°:</strong> {reportData.monthlyRent?.toLocaleString() || '0'}</p>
            </div>
            
            {reportData.amortizationTable && reportData.amortizationTable.length > 0 ? (
              <table className={styles.amortizationTable}>
                <thead>
                  <tr>
                    <th>‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà</th>
                    <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏° (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</th>
                    <th>‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏ì ‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î (‡∏´‡∏ô‡πà‡∏ß‡∏¢ : ‡∏ö‡∏≤‡∏ó)</th>
                  </tr>
                </thead>
                <tbody>
                  {reportData.amortizationTable
                    .filter(row => {
                      const installment = row.installment || row.period || 0;
                      if (typeof installment === 'string' && installment.includes('‡∏™‡∏¥‡πâ‡∏ô‡∏á‡∏ß‡∏î')) {
                        return true;
                      }
                      if (typeof installment === 'number') {
                        return [12, 24, 36].includes(installment);
                      }
                      return false;
                    })
                    .map((row, index) => {
                      const installment = row.installment || row.period || 0;
                      const savings = row.payment || row.savings || 0;
                      const remaining = row.remainingPrincipal || row.remaining || 0;
                      
                      return (
                        <tr key={index}>
                          <td>{installment}</td>
                          <td>{savings ? savings.toLocaleString() : '0'}</td>
                          <td>{remaining ? remaining.toLocaleString() : '0'}</td>
                        </tr>
                      );
                    })}
                </tbody>
              </table>
            ) : (
              <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°</p>
            )}
            
            <p className={styles.disclaimer}>
              ***‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£ ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ ‡∏ï‡∏≤‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏±‡∏ç‡∏ç‡∏≤ 4: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°‡∏ö‡πâ‡∏≤‡∏ô
            </p>
            
            <p className={styles.analyst}>
              <strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢:</strong> {reportData.analyst}
            </p>
          </div>

          {/* ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î */}
          <div className={styles.section}>
            <h3>‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î</h3>
            <div className={styles.disclaimerSection}>
              <p>
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏à‡∏î‡∏µ ‡∏à‡∏≥‡∏Å‡∏±‡∏î ("‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó") ‡∏Ç‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
              </p>
              <p>
                ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡πÉ‡∏î‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
              </p>
              
              <div className={styles.acknowledgement}>
                <p><strong>‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß</strong></p>
                <div className={styles.signatureSection}>
                  <p>‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠: _________________ (‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≠‡∏°)</p>
                </div>
              </div>
              
              <p className={styles.adviceNote}>
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ Livnex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏µ‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏à‡∏î‡∏µ ‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
              </p>
              
              <p className={styles.analyst}>
                <strong>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏î‡∏¢:</strong> {reportData.analyst}
              </p>
            </div>
          </div>

          {/* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ */}
          <div className={styles.contactSection}>
            <div className={styles.contactInfo}>
              <p><strong>LINE:</strong> @livnex</p>
              <p><strong>Website:</strong> www.livnex.co</p>
              <p><strong>Call:</strong> 1776</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ConsumerAdviseReport; 
